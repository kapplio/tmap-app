<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>taneto field – 暮らしのつくり手マップ（test）</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Leaflet（地図ライブラリ）CDN -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />
  <script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
    crossorigin=""
  ></script>

  <style>
    :root {
      --bg: #f8f7f3;
      --bg-alt: #ffffff;
      --primary: #3c8c6a;
      --primary-soft: #e2f3eb;
      --accent: #f4b43a;
      --text-main: #333333;
      --text-sub: #777777;
      --border-soft: #e0ded8;
      --radius-lg: 18px;
      --shadow-soft: 0 8px 24px rgba(0, 0, 0, 0.08);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: var(--bg);
      color: var(--text-main);
    }

    .app-shell {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 20px;
      background: var(--bg-alt);
      border-bottom: 1px solid var(--border-soft);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .brand-mark {
      width: 32px;
      height: 32px;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-weight: 700;
      font-size: 15px;
    }

    .brand-text-main {
      font-weight: 700;
      letter-spacing: 0.03em;
    }

    .brand-text-sub {
      font-size: 11px;
      color: var(--text-sub);
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .pill {
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 11px;
      background: var(--primary-soft);
      color: var(--primary);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .pill-badge {
      background: var(--primary);
      color: #fff;
      border-radius: 999px;
      padding: 2px 7px;
      font-size: 10px;
    }

    .btn-outline {
      border-radius: 999px;
      padding: 6px 12px;
      font-size: 11px;
      border: 1px solid var(--border-soft);
      background: #fff;
      cursor: pointer;
    }

    .btn-outline:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    .main {
      flex: 1;
      display: flex;
      min-height: 0;
    }

    /* 左ペイン：リスト */
    .sidebar {
      width: 320px;
      min-width: 260px;
      max-width: 400px;
      border-right: 1px solid var(--border-soft);
      display: flex;
      flex-direction: column;
      background: #fcfbf7;
    }

    .sidebar-header {
      padding: 12px 16px 6px;
    }

    .sidebar-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .sidebar-sub {
      font-size: 11px;
      color: var(--text-sub);
    }

    .sidebar-search {
      padding: 8px 16px 10px;
    }

    .search-input {
      width: 100%;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      padding: 6px 10px;
      font-size: 12px;
    }

    .sidebar-list {
      flex: 1;
      overflow-y: auto;
      padding: 8px 12px 16px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .maker-card {
      background: var(--bg-alt);
      border-radius: var(--radius-lg);
      padding: 8px 10px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.03);
      border: 1px solid transparent;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      gap: 4px;
      transition: box-shadow 0.15s ease, transform 0.15s ease,
        border-color 0.15s ease;
    }

    .maker-card:hover {
      box-shadow: var(--shadow-soft);
      transform: translateY(-1px);
      border-color: var(--primary-soft);
    }

    .maker-card-active {
      border-color: var(--primary);
      box-shadow: var(--shadow-soft);
    }

    .maker-name {
      font-size: 13px;
      font-weight: 600;
    }

    .maker-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 2px;
    }

    .tag {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      background: var(--primary-soft);
      color: var(--primary);
    }

    .tag-alt {
      background: #fbe9d1;
      color: #c57a1a;
    }

    .maker-meta {
      font-size: 11px;
      color: var(--text-sub);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    /* 中央：地図 */
    #map {
      flex: 1;
      min-width: 0;
      min-height: 300px; /* デスクトップでも最低高さ確保 */
    }

    /* 右ペイン：詳細＋ログ */
    .detail-panel {
      width: 340px;
      min-width: 280px;
      max-width: 380px;
      border-left: 1px solid var(--border-soft);
      background: #fdfbf8;
      display: flex;
      flex-direction: column;
    }

    .detail-header {
      padding: 10px 14px 6px;
      border-bottom: 1px solid var(--border-soft);
    }

    .detail-title {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .detail-sub {
      font-size: 11px;
      color: var(--text-sub);
    }

    .detail-body {
      padding: 10px 14px 8px;
      overflow-y: auto;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .detail-section-title {
      font-size: 11px;
      font-weight: 600;
      color: var(--text-sub);
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .detail-description {
      font-size: 12px;
      line-height: 1.6;
    }

    .detail-actions {
      display: flex;
      gap: 8px;
      margin-top: 4px;
      flex-wrap: wrap;
    }

    .btn-primary {
      flex: 1;
      min-width: 0;
      border-radius: 999px;
      border: none;
      padding: 8px 12px;
      font-size: 12px;
      background: var(--primary);
      color: #fff;
      cursor: pointer;
    }

    .btn-primary:hover {
      filter: brightness(1.05);
    }

    .btn-secondary {
      flex: 1;
      min-width: 0;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      padding: 8px 12px;
      font-size: 12px;
      background: #fff;
      cursor: pointer;
    }

    .btn-secondary:hover {
      border-color: var(--primary);
      color: var(--primary);
    }

    .detail-log {
      border-top: 1px solid var(--border-soft);
      padding: 8px 14px 10px;
      background: #fcfaf5;
    }

    .log-list {
      margin-top: 4px;
      max-height: 120px;
      overflow-y: auto;
      padding-left: 0;
      list-style: none;
    }

    .log-item {
      font-size: 11px;
      margin-bottom: 4px;
      color: var(--text-sub);
    }

    .log-item strong {
      color: var(--text-main);
    }

    .empty-state {
      font-size: 11px;
      color: var(--text-sub);
      margin-top: 4px;
    }

    /* スマホレイアウト */
    @media (max-width: 900px) {
      .main {
        flex-direction: column;
      }
      .sidebar {
        width: 100%;
        max-width: none;
        border-right: none;
        border-bottom: 1px solid var(--border-soft);
      }
      .detail-panel {
        width: 100%;
        max-width: none;
        border-left: none;
        border-top: 1px solid var(--border-soft);
      }
      #map {
        flex: none;           /* ← ここを追加：flex の影響を切る */
        height: 320px;        /* ← ここでしっかり高さを指定 */
      }
    }
  </style>
</head>
<body>
<div class="app-shell">
  <header>
    <div class="brand">
      <div class="brand-mark">t</div>
      <div>
        <div class="brand-text-main">taneto field</div>
        <div class="brand-text-sub">暮らしのつくり手と出会うマップ</div>
      </div>
    </div>
    <div class="header-right">
      <div class="pill">
        マイログ
        <span id="log-count" class="pill-badge">0</span>
      </div>
      <button class="btn-outline" id="clear-log-btn">ログをクリア</button>
    </div>
  </header>

  <div class="main">
    <!-- 左：リスト -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-title">暮らしのつくり手</div>
        <div class="sidebar-sub">気になる場所をクリックすると地図と詳細が開きます</div>
      </div>
      <div class="sidebar-search">
        <input
          type="text"
          id="search-input"
          class="search-input"
          placeholder="キーワードでさがす（例：畑、森、発酵）"
        />
      </div>
      <div id="maker-list" class="sidebar-list"></div>
    </aside>

    <!-- 中央：地図 -->
    <div id="map"></div>

    <!-- 右：詳細＋ログ -->
    <aside class="detail-panel">
      <div class="detail-header">
        <div class="detail-title" id="detail-title">
          右または左から、つくり手を選んでください
        </div>
        <div class="detail-sub" id="detail-sub">
          ストーリーと場所、参加の入り口がここに表示されます。
        </div>
      </div>
      <div class="detail-body">
        <div>
          <div class="detail-section-title">story</div>
          <div class="detail-description" id="detail-description">
            暮らしのつくり手を選ぶと、ここにその人の物語や現場の様子が表示されます。
          </div>
        </div>
        <div>
          <div class="detail-section-title">場所</div>
          <div class="detail-description" id="detail-location">
            地図上のピンと連動して、エリアやアクセスのイメージを表示します。
          </div>
        </div>
        <div>
          <div class="detail-section-title">アクション</div>
          <div class="detail-actions">
            <button class="btn-primary" id="btn-interest" disabled>
              気になるリストに追加
            </button>
            <button class="btn-secondary" id="btn-join" disabled>
              「参加した」ログを残す
            </button>
          </div>
        </div>
      </div>
      <div class="detail-log">
        <div class="detail-section-title">my log</div>
        <ul id="log-list" class="log-list"></ul>
        <div id="log-empty" class="empty-state">
          まだログはありません。<br />
          「気になる」や「参加した」を押すと、ここに記録されます。
        </div>
      </div>
    </aside>
  </div>
</div>

<script>
  // ダミーデータ：暮らしのつくり手（座標は適当な例）
  const makers = [
    {
      id: "ookoshi-farm",
      name: "大越さんの畑と朝ごはん",
      category: ["畑", "食", "子育て歓迎"],
      lat: 35.502,
      lng: 138.784,
      area: "山梨県・甲府〜笛吹エリア",
      note: "平日の朝、畑の手入れをしながら一緒に朝ごはんを食べる小さな時間。子ども連れOKのゆるやかな場です。",
      keywords: "畑 野菜 朝ごはん 子ども 甲府",
    },
    {
      id: "mori-gibier",
      name: "森のジビエと焚き火の夜",
      category: ["森", "食", "対話"],
      lat: 35.55,
      lng: 138.9,
      area: "山梨県・都留エリア",
      note: "山で暮らす人のお話を聞きながら、焚き火を囲んでジビエ料理を味わう夜。命の循環について静かに考える時間です。",
      keywords: "森 ジビエ 焚き火 夜 都留 対話",
    },
    {
      id: "hakko-room",
      name: "発酵と小さな台所",
      category: ["発酵", "学び", "食"],
      lat: 35.67,
      lng: 138.75,
      area: "山梨県・甲州市エリア",
      note: "味噌やぬか床を仕込みながら、「暮らしをつくる」という感覚を取り戻す少人数の発酵ワークショップ。",
      keywords: "発酵 味噌 ぬか床 ワークショップ 甲州",
    },
    {
      id: "milk-circle",
      name: "牧場の朝とミルクの話",
      category: ["動物", "循環", "家族"],
      lat: 35.87,
      lng: 138.4,
      area: "山梨県・北杜エリア",
      note: "牛たちの朝の時間を見学しながら、いのちの循環とミルクの裏側の物語を聞くフィールドツアー。",
      keywords: "牧場 ミルク 牛 北杜 フィールドツアー",
    },
  ];

  // 地図の初期化
  const map = L.map("map").setView([35.6, 138.7], 9);

  L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    maxZoom: 18,
    attribution: "&copy; OpenStreetMap contributors",
  }).addTo(map);

  const markersById = {};

  makers.forEach((m) => {
    const marker = L.marker([m.lat, m.lng]).addTo(map);
    marker.on("click", () => {
      selectMaker(m.id, { fromMap: true });
    });
    markersById[m.id] = marker;
  });

  // ウィンドウサイズ変更時に地図を再計算（スマホで真っ白防止）
  window.addEventListener("resize", () => {
    map.invalidateSize();
  });

  // UI参照
  const listEl = document.getElementById("maker-list");
  const searchEl = document.getElementById("search-input");
  const detailTitleEl = document.getElementById("detail-title");
  const detailSubEl = document.getElementById("detail-sub");
  const detailDescEl = document.getElementById("detail-description");
  const detailLocEl = document.getElementById("detail-location");
  const btnInterest = document.getElementById("btn-interest");
  const btnJoin = document.getElementById("btn-join");
  const logListEl = document.getElementById("log-list");
  const logEmptyEl = document.getElementById("log-empty");
  const logCountEl = document.getElementById("log-count");
  const clearLogBtn = document.getElementById("clear-log-btn");

  let activeMakerId = null;

  function renderList(filter = "") {
    listEl.innerHTML = "";
    const q = filter.trim().toLowerCase();
    makers
      .filter((m) => {
        if (!q) return true;
        return (
          m.name.toLowerCase().includes(q) ||
          (m.keywords && m.keywords.toLowerCase().includes(q))
        );
      })
      .forEach((m) => {
        const card = document.createElement("div");
        card.className =
          "maker-card" + (m.id === activeMakerId ? " maker-card-active" : "");
        card.dataset.id = m.id;

        const name = document.createElement("div");
        name.className = "maker-name";
        name.textContent = m.name;
        card.appendChild(name);

        const tags = document.createElement("div");
        tags.className = "maker-tags";
        m.category.forEach((c, idx) => {
          const tag = document.createElement("span");
          tag.className = "tag" + (idx === 0 ? "" : " tag-alt");
          tag.textContent = c;
          tags.appendChild(tag);
        });
        card.appendChild(tags);

        const meta = document.createElement("div");
        meta.className = "maker-meta";
        meta.innerHTML = `<span>${m.area}</span><span>▶</span>`;
        card.appendChild(meta);

        card.addEventListener("click", () => {
          selectMaker(m.id, { fromList: true });
        });

        listEl.appendChild(card);
      });
  }

  function selectMaker(id, options = {}) {
    activeMakerId = id;

    // サイドバーの見た目更新
    Array.from(listEl.children).forEach((child) => {
      if (child.dataset.id === id) {
        child.classList.add("maker-card-active");
      } else {
        child.classList.remove("maker-card-active");
      }
    });

    const maker = makers.find((m) => m.id === id);
    if (!maker) return;

    detailTitleEl.textContent = maker.name;
    detailSubEl.textContent = maker.area;
    detailDescEl.textContent = maker.note;
    detailLocEl.textContent = `だいたいこのあたり：${maker.area}（地図のピンを参考にしてください）`;

    btnInterest.disabled = false;
    btnJoin.disabled = false;

    // 地図をその場所にズーム
    if (options.fromList) {
      map.setView([maker.lat, maker.lng], 11);
      map.invalidateSize();
    }
  }

  // 検索
  searchEl.addEventListener("input", () => {
    renderList(searchEl.value);
  });

  // ログ管理（localStorage）
  const LOG_KEY = "taneto_sample_log";

  function loadLog() {
    try {
      const raw = localStorage.getItem(LOG_KEY);
      if (!raw) return [];
      const data = JSON.parse(raw);
      if (Array.isArray(data)) return data;
      return [];
    } catch (e) {
      return [];
    }
  }

  function saveLog(log) {
    localStorage.setItem(LOG_KEY, JSON.stringify(log));
  }

  function renderLog() {
    const log = loadLog();
    logListEl.innerHTML = "";
    if (log.length === 0) {
      logEmptyEl.style.display = "block";
      logCountEl.textContent = "0";
      return;
    }
    logEmptyEl.style.display = "none";
    logCountEl.textContent = String(log.length);
    log
      .slice()
      .reverse()
      .forEach((entry) => {
        const li = document.createElement("li");
        li.className = "log-item";
        const date = new Date(entry.timestamp);
        const dateStr = date.toLocaleString("ja-JP", {
          month: "short",
          day: "numeric",
          hour: "2-digit",
          minute: "2-digit",
        });
        li.innerHTML = `<strong>${entry.type}</strong>：${entry.name}（${dateStr}）`;
        logListEl.appendChild(li);
      });
  }

  function addLogEntry(type) {
    if (!activeMakerId) return;
    const maker = makers.find((m) => m.id === activeMakerId);
    if (!maker) return;
    const log = loadLog();
    log.push({
      id: maker.id,
      name: maker.name,
      type: type,
      timestamp: Date.now(),
    });
    saveLog(log);
    renderLog();
  }

  btnInterest.addEventListener("click", () => {
    addLogEntry("気になる");
  });

  btnJoin.addEventListener("click", () => {
    addLogEntry("参加した");
  });

  clearLogBtn.addEventListener("click", () => {
    if (confirm("マイログをすべて削除しますか？")) {
      localStorage.removeItem(LOG_KEY);
      renderLog();
    }
  });

  // 初期レンダリング
  renderList();
  renderLog();

  // 初期表示時にもサイズを補正しておくと安定
  setTimeout(() => {
    map.invalidateSize();
  }, 300);
</script>
</body>
</html>


